2025-07-30 00:01:17.810 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 00:01:17.822 +03:00 [INF] CORS policy execution successful.
2025-07-30 00:01:17.824 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 14.3347ms
2025-07-30 00:01:17.828 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 72
2025-07-30 00:01:17.830 +03:00 [INF] CORS policy execution successful.
2025-07-30 00:01:17.831 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 00:01:17.833 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.LoginDto) on controller ElectricityTrackerAPI.Controllers.AuthController (TrackerAPI).
2025-07-30 00:01:17.903 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."LastLoginAt", u."LastName", u."PasswordHash", u."Phone", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."CompanyName", t."ContactPerson", t."CreatedAt", t."CustomDomain", t."Email", t."IsActive", t."MaxFacilities", t."MaxUsers", t."Phone", t."Status", t."Subdomain", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 00:01:18.041 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "LastLoginAt" = @p0
WHERE "Id" = @p1;
2025-07-30 00:01:18.044 +03:00 [INF] User Activity: Login successful - User: testadmin@example.com
2025-07-30 00:01:18.046 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 00:01:18.050 +03:00 [INF] Executing OkObjectResult, writing value of type 'ElectricityTrackerAPI.DTOs.LoginResponseDto'.
2025-07-30 00:01:18.051 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI) in 215.3826ms
2025-07-30 00:01:18.052 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 00:01:18.053 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 200 null application/json; charset=utf-8 225.571ms
2025-07-30 00:38:58.746 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 00:38:58.750 +03:00 [INF] CORS policy execution successful.
2025-07-30 00:38:58.752 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 5.5684ms
2025-07-30 00:38:58.755 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 72
2025-07-30 00:38:58.758 +03:00 [INF] CORS policy execution successful.
2025-07-30 00:38:58.759 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 00:38:58.760 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.LoginDto) on controller ElectricityTrackerAPI.Controllers.AuthController (TrackerAPI).
2025-07-30 00:38:58.838 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."LastLoginAt", u."LastName", u."PasswordHash", u."Phone", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."CompanyName", t."ContactPerson", t."CreatedAt", t."CustomDomain", t."Email", t."IsActive", t."MaxFacilities", t."MaxUsers", t."Phone", t."Status", t."Subdomain", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 00:38:58.990 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "LastLoginAt" = @p0
WHERE "Id" = @p1;
2025-07-30 00:38:58.993 +03:00 [INF] User Activity: Login successful - User: testadmin@example.com
2025-07-30 00:38:58.997 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 00:38:59.002 +03:00 [INF] Executing OkObjectResult, writing value of type 'ElectricityTrackerAPI.DTOs.LoginResponseDto'.
2025-07-30 00:38:59.004 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI) in 242.1094ms
2025-07-30 00:38:59.006 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 00:38:59.008 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 200 null application/json; charset=utf-8 252.513ms
2025-07-30 18:55:22.036 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 18:55:22.044 +03:00 [INF] CORS policy execution successful.
2025-07-30 18:55:22.047 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 11.4545ms
2025-07-30 18:55:22.059 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 72
2025-07-30 18:55:22.067 +03:00 [INF] CORS policy execution successful.
2025-07-30 18:55:22.071 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 18:55:22.079 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.LoginDto) on controller ElectricityTrackerAPI.Controllers.AuthController (TrackerAPI).
2025-07-30 18:55:22.208 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."LastLoginAt", u."LastName", u."PasswordHash", u."Phone", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."CompanyName", t."ContactPerson", t."CreatedAt", t."CustomDomain", t."Email", t."IsActive", t."MaxFacilities", t."MaxUsers", t."Phone", t."Status", t."Subdomain", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 18:55:22.378 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "LastLoginAt" = @p0
WHERE "Id" = @p1;
2025-07-30 18:55:22.388 +03:00 [INF] User Activity: Login successful - User: testadmin@example.com
2025-07-30 18:55:22.395 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 18:55:22.405 +03:00 [INF] Executing OkObjectResult, writing value of type 'ElectricityTrackerAPI.DTOs.LoginResponseDto'.
2025-07-30 18:55:22.410 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI) in 321.0605ms
2025-07-30 18:55:22.414 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 18:55:22.418 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 200 null application/json; charset=utf-8 358.0738ms
2025-07-30 18:55:27.923 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 18:55:27.926 +03:00 [INF] CORS policy execution successful.
2025-07-30 18:55:27.928 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 4.3287ms
2025-07-30 18:55:27.949 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 72
2025-07-30 18:55:27.952 +03:00 [INF] CORS policy execution successful.
2025-07-30 18:55:27.953 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 18:55:27.954 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.LoginDto) on controller ElectricityTrackerAPI.Controllers.AuthController (TrackerAPI).
2025-07-30 18:55:27.959 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."LastLoginAt", u."LastName", u."PasswordHash", u."Phone", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."CompanyName", t."ContactPerson", t."CreatedAt", t."CustomDomain", t."Email", t."IsActive", t."MaxFacilities", t."MaxUsers", t."Phone", t."Status", t."Subdomain", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 18:55:28.145 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "LastLoginAt" = @p0
WHERE "Id" = @p1;
2025-07-30 18:55:28.148 +03:00 [INF] User Activity: Login successful - User: testadmin@example.com
2025-07-30 18:55:28.151 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 18:55:28.154 +03:00 [INF] Executing OkObjectResult, writing value of type 'ElectricityTrackerAPI.DTOs.LoginResponseDto'.
2025-07-30 18:55:28.159 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI) in 203.0503ms
2025-07-30 18:55:28.161 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 18:55:28.162 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 200 null application/json; charset=utf-8 213.0231ms
2025-07-30 19:16:34.200 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 19:16:34.204 +03:00 [INF] CORS policy execution successful.
2025-07-30 19:16:34.205 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 4.711ms
2025-07-30 19:16:34.209 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 72
2025-07-30 19:16:34.212 +03:00 [INF] CORS policy execution successful.
2025-07-30 19:16:34.213 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 19:16:34.215 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.LoginDto) on controller ElectricityTrackerAPI.Controllers.AuthController (TrackerAPI).
2025-07-30 19:16:34.308 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."LastLoginAt", u."LastName", u."PasswordHash", u."Phone", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."CompanyName", t."ContactPerson", t."CreatedAt", t."CustomDomain", t."Email", t."IsActive", t."MaxFacilities", t."MaxUsers", t."Phone", t."Status", t."Subdomain", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 19:16:34.480 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "LastLoginAt" = @p0
WHERE "Id" = @p1;
2025-07-30 19:16:34.483 +03:00 [INF] User Activity: Login successful - User: testadmin@example.com
2025-07-30 19:16:34.488 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 19:16:34.492 +03:00 [INF] Executing OkObjectResult, writing value of type 'ElectricityTrackerAPI.DTOs.LoginResponseDto'.
2025-07-30 19:16:34.495 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI) in 278.2158ms
2025-07-30 19:16:34.497 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.AuthController.Login (TrackerAPI)'
2025-07-30 19:16:34.498 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 200 null application/json; charset=utf-8 289.4363ms
2025-07-30 21:49:59.665 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:49:59.919 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:49:59.991 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 21:50:00.019 +03:00 [INF] Applying migration '20250730184924_AdminPanelModels'.
2025-07-30 21:50:00.169 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" RENAME COLUMN "Email" TO "Domain";
2025-07-30 21:50:00.175 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_Tenants_Email" RENAME TO "IX_Tenants_Domain";
2025-07-30 21:50:00.186 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "IsLocked" boolean NOT NULL DEFAULT FALSE;
2025-07-30 21:50:00.191 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastFailedLogin" timestamp with time zone NULL;
2025-07-30 21:50:00.196 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginIp" text NULL;
2025-07-30 21:50:00.200 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginUserAgent" text NULL;
2025-07-30 21:50:00.203 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockReason" text NULL;
2025-07-30 21:50:00.207 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockedAt" timestamp with time zone NULL;
2025-07-30 21:50:00.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LoginAttempts" integer NOT NULL DEFAULT 0;
2025-07-30 21:50:00.214 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "PasswordChangedAt" timestamp with time zone NULL;
2025-07-30 21:50:00.217 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "RequirePasswordChange" boolean NOT NULL DEFAULT FALSE;
2025-07-30 21:50:00.221 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "Phone" DROP NOT NULL;
2025-07-30 21:50:00.224 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "ContactPerson" DROP NOT NULL;
2025-07-30 21:50:00.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "AdminEmail" character varying(100) NOT NULL DEFAULT '';
2025-07-30 21:50:00.232 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Currency" text NOT NULL DEFAULT '';
2025-07-30 21:50:00.235 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "FacilityCode" character varying(6) NOT NULL DEFAULT '';
2025-07-30 21:50:00.238 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Language" text NOT NULL DEFAULT '';
2025-07-30 21:50:00.241 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastLogin" timestamp with time zone NULL;
2025-07-30 21:50:00.244 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastPayment" timestamp with time zone NULL;
2025-07-30 21:50:00.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Logo" text NULL;
2025-07-30 21:50:00.251 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "MonthlyFee" numeric NOT NULL DEFAULT 0.0;
2025-07-30 21:50:00.253 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "PaymentStatus" integer NOT NULL DEFAULT 0;
2025-07-30 21:50:00.257 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Subscription" integer NOT NULL DEFAULT 0;
2025-07-30 21:50:00.261 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "TotalConsumption" text NULL;
2025-07-30 21:50:00.278 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiKeys" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Key" character varying(64) NOT NULL,
    "TenantId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastUsed" timestamp with time zone NULL,
    "TotalCalls" integer NOT NULL,
    "ErrorRate" numeric NOT NULL,
    "RateLimit" integer NOT NULL,
    "RateLimitPeriod" text NOT NULL,
    "WebhookUrl" text NULL,
    "WebhookStatus" integer NULL,
    "Permissions" text NOT NULL,
    CONSTRAINT "PK_ApiKeys" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiKeys_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:50:00.287 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "SystemLogs" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TenantId" integer NULL,
    "UserId" integer NULL,
    "Level" character varying(50) NOT NULL,
    "Category" character varying(100) NOT NULL,
    "Message" character varying(200) NOT NULL,
    "Details" text NULL,
    "IpAddress" text NULL,
    "UserAgent" text NULL,
    "Timestamp" timestamp with time zone NOT NULL,
    "Exception" text NULL,
    "StackTrace" text NULL,
    CONSTRAINT "PK_SystemLogs" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SystemLogs_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_SystemLogs_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 21:50:00.300 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiUsages" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ApiKeyId" integer NOT NULL,
    "Date" timestamp with time zone NOT NULL,
    "Calls" integer NOT NULL,
    "Errors" integer NOT NULL,
    "AvgResponseTime" integer NOT NULL,
    "PeakHour" text NOT NULL,
    CONSTRAINT "PK_ApiUsages" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiUsages_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:50:00.309 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Webhooks" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Url" character varying(500) NOT NULL,
    "ApiKeyId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastDelivery" timestamp with time zone NULL,
    "SuccessRate" numeric NOT NULL,
    "RetryCount" integer NOT NULL,
    "Events" text NOT NULL,
    CONSTRAINT "PK_Webhooks" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Webhooks_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:50:00.315 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "AdminEmail" = 'info@demosirketi.com', "Currency" = 'TRY', "Domain" = '', "FacilityCode" = '', "Language" = 'tr', "LastLogin" = NULL, "LastPayment" = NULL, "Logo" = NULL, "MonthlyFee" = 99.99, "PaymentStatus" = 1, "Status" = 3, "Subscription" = 0, "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-30 18:49:24.125275Z', "TotalConsumption" = '0 kWh'
WHERE "Id" = 1;
2025-07-30 21:50:00.321 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "IsLocked" = FALSE, "LastFailedLogin" = NULL, "LastLoginIp" = NULL, "LastLoginUserAgent" = NULL, "LockReason" = NULL, "LockedAt" = NULL, "LoginAttempts" = 0, "PasswordChangedAt" = NULL, "RequirePasswordChange" = FALSE
WHERE "Id" = 1;
2025-07-30 21:50:00.326 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_AdminEmail" ON "Tenants" ("AdminEmail");
2025-07-30 21:50:00.357 +03:00 [ERR] Failed executing DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_FacilityCode" ON "Tenants" ("FacilityCode");
2025-07-30 21:50:16.612 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:50:16.734 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:50:16.759 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 21:50:16.780 +03:00 [INF] Reverting migration '20250729202124_AddLogEntries'.
2025-07-30 21:50:16.838 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "LogEntries";
2025-07-30 21:50:16.843 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-29 20:02:27.926878Z'
WHERE "Id" = 1;
2025-07-30 21:50:16.845 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsHistory"
WHERE "MigrationId" = '20250729202124_AddLogEntries';
2025-07-30 21:50:16.858 +03:00 [INF] Reverting migration '20250729200228_InitialCreate'.
2025-07-30 21:50:16.862 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ConsumptionRecords";
2025-07-30 21:50:16.867 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Users";
2025-07-30 21:50:16.871 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "ElectricityMeters";
2025-07-30 21:50:16.874 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Facilities";
2025-07-30 21:50:16.878 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Departments";
2025-07-30 21:50:16.882 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Tenants";
2025-07-30 21:50:16.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsHistory"
WHERE "MigrationId" = '20250729200228_InitialCreate';
2025-07-30 21:50:30.054 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:50:30.122 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 21:51:32.679 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:51:32.940 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 21:51:32.975 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 21:51:33.011 +03:00 [INF] Applying migration '20250729200228_InitialCreate'.
2025-07-30 21:51:33.189 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Tenants" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "CompanyName" character varying(100) NOT NULL,
    "ContactPerson" character varying(100) NOT NULL,
    "Email" character varying(100) NOT NULL,
    "Phone" character varying(20) NOT NULL,
    "Address" character varying(200) NULL,
    "TaxNumber" character varying(50) NULL,
    "TaxOffice" character varying(50) NULL,
    "Subdomain" character varying(50) NULL,
    "CustomDomain" character varying(100) NULL,
    "Status" integer NOT NULL,
    "SubscriptionStartDate" timestamp with time zone NOT NULL,
    "SubscriptionEndDate" timestamp with time zone NULL,
    "MaxUsers" integer NOT NULL,
    "MaxFacilities" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_Tenants" PRIMARY KEY ("Id")
);
2025-07-30 21:51:33.203 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Departments" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Description" character varying(500) NULL,
    "ManagerName" character varying(100) NULL,
    "ManagerEmail" character varying(100) NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    CONSTRAINT "PK_Departments" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Departments_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.216 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Facilities" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Address" character varying(200) NULL,
    "FacilityCode" character varying(50) NULL,
    "Type" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "DepartmentId" integer NULL,
    CONSTRAINT "PK_Facilities" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Facilities_Departments_DepartmentId" FOREIGN KEY ("DepartmentId") REFERENCES "Departments" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_Facilities_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.229 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Users" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "FirstName" character varying(100) NOT NULL,
    "LastName" character varying(100) NOT NULL,
    "Email" character varying(100) NOT NULL,
    "PasswordHash" character varying(255) NOT NULL,
    "Phone" character varying(20) NULL,
    "Role" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "LastLoginAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "DepartmentId" integer NULL,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Users_Departments_DepartmentId" FOREIGN KEY ("DepartmentId") REFERENCES "Departments" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_Users_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.246 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ElectricityMeters" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "MeterNumber" character varying(50) NOT NULL,
    "Description" character varying(100) NULL,
    "Type" integer NOT NULL,
    "CurrentReading" numeric NOT NULL,
    "PreviousReading" numeric NOT NULL,
    "LastReadingDate" timestamp with time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "FacilityId" integer NOT NULL,
    CONSTRAINT "PK_ElectricityMeters" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ElectricityMeters_Facilities_FacilityId" FOREIGN KEY ("FacilityId") REFERENCES "Facilities" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_ElectricityMeters_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.267 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ConsumptionRecords" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ReadingDate" timestamp with time zone NOT NULL,
    "CurrentReading" numeric NOT NULL,
    "PreviousReading" numeric NOT NULL,
    "Consumption" numeric NOT NULL,
    "UnitPrice" numeric NOT NULL,
    "TotalCost" numeric NOT NULL,
    "Source" integer NOT NULL,
    "Notes" text NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "ElectricityMeterId" integer NOT NULL,
    CONSTRAINT "PK_ConsumptionRecords" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ConsumptionRecords_ElectricityMeters_ElectricityMeterId" FOREIGN KEY ("ElectricityMeterId") REFERENCES "ElectricityMeters" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_ConsumptionRecords_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.279 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Tenants" ("Id", "Address", "CompanyName", "ContactPerson", "CreatedAt", "CustomDomain", "Email", "IsActive", "MaxFacilities", "MaxUsers", "Phone", "Status", "Subdomain", "SubscriptionEndDate", "SubscriptionStartDate", "TaxNumber", "TaxOffice", "UpdatedAt")
VALUES (1, 'İstanbul, Türkiye', 'Demo Şirketi A.Ş.', 'Ahmet Yılmaz', TIMESTAMPTZ '2024-01-01 00:00:00Z', NULL, 'info@demosirketi.com', TRUE, 5, 10, '+90 212 555 0123', 0, NULL, NULL, TIMESTAMPTZ '2025-07-29 20:02:27.926878Z', '1234567890', 'Kadıköy', NULL);
2025-07-30 21:51:33.287 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Departments" ("Id", "CreatedAt", "Description", "IsActive", "ManagerEmail", "ManagerName", "Name", "TenantId", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 'Şirket genel yönetim departmanı', TRUE, 'ahmet@demosirketi.com', 'Ahmet Yılmaz', 'Genel Yönetim', 1, NULL);
2025-07-30 21:51:33.294 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Facilities" ("Id", "Address", "CreatedAt", "DepartmentId", "FacilityCode", "IsActive", "Name", "TenantId", "Type", "UpdatedAt")
VALUES (1, 'Kadıköy, İstanbul', TIMESTAMPTZ '2024-01-01 00:00:00Z', 1, 'OFIS001', TRUE, 'Ana Ofis', 1, 0, NULL);
2025-07-30 21:51:33.300 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "CreatedAt", "DepartmentId", "Email", "FirstName", "IsActive", "LastLoginAt", "LastName", "PasswordHash", "Phone", "Role", "TenantId", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 1, 'admin@example.com', 'Admin', TRUE, NULL, 'User', '$2a$11$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/HS.iK2O', NULL, 0, 1, NULL);
2025-07-30 21:51:33.307 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ElectricityMeters" ("Id", "CreatedAt", "CurrentReading", "Description", "FacilityId", "IsActive", "LastReadingDate", "MeterNumber", "PreviousReading", "TenantId", "Type", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 1500.5, 'Ana ofis elektrik sayacı', 1, TRUE, TIMESTAMPTZ '2023-12-31 00:00:00Z', 'MTR001', 1400.0, 1, 0, NULL);
2025-07-30 21:51:33.313 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_ElectricityMeterId" ON "ConsumptionRecords" ("ElectricityMeterId");
2025-07-30 21:51:33.319 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_TenantId_ElectricityMeterId_ReadingDate" ON "ConsumptionRecords" ("TenantId", "ElectricityMeterId", "ReadingDate");
2025-07-30 21:51:33.329 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Departments_TenantId_Name" ON "Departments" ("TenantId", "Name");
2025-07-30 21:51:33.336 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ElectricityMeters_FacilityId" ON "ElectricityMeters" ("FacilityId");
2025-07-30 21:51:33.345 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ElectricityMeters_TenantId_MeterNumber" ON "ElectricityMeters" ("TenantId", "MeterNumber");
2025-07-30 21:51:33.351 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Facilities_DepartmentId" ON "Facilities" ("DepartmentId");
2025-07-30 21:51:33.357 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Facilities_TenantId_FacilityCode" ON "Facilities" ("TenantId", "FacilityCode");
2025-07-30 21:51:33.363 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_Email" ON "Tenants" ("Email");
2025-07-30 21:51:33.371 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_TaxNumber" ON "Tenants" ("TaxNumber");
2025-07-30 21:51:33.378 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Users_DepartmentId" ON "Users" ("DepartmentId");
2025-07-30 21:51:33.390 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Users_Email" ON "Users" ("Email");
2025-07-30 21:51:33.397 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Users_TenantId" ON "Users" ("TenantId");
2025-07-30 21:51:33.413 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT setval(
    pg_get_serial_sequence('"Tenants"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Tenants") + 1,
        nextval(pg_get_serial_sequence('"Tenants"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Departments"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Departments") + 1,
        nextval(pg_get_serial_sequence('"Departments"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Facilities"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Facilities") + 1,
        nextval(pg_get_serial_sequence('"Facilities"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Users"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Users") + 1,
        nextval(pg_get_serial_sequence('"Users"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"ElectricityMeters"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "ElectricityMeters") + 1,
        nextval(pg_get_serial_sequence('"ElectricityMeters"', 'Id'))),
    false);
2025-07-30 21:51:33.418 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250729200228_InitialCreate', '7.0.11');
2025-07-30 21:51:33.429 +03:00 [INF] Applying migration '20250729202124_AddLogEntries'.
2025-07-30 21:51:33.480 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "LogEntries" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Timestamp" timestamp with time zone NOT NULL,
    "Level" character varying(50) NOT NULL,
    "Message" character varying(255) NOT NULL,
    "Source" character varying(100) NULL,
    "UserId" character varying(100) NULL,
    "UserEmail" character varying(100) NULL,
    "TenantId" character varying(50) NULL,
    "RequestPath" character varying(255) NULL,
    "RequestMethod" character varying(20) NULL,
    "IpAddress" character varying(45) NULL,
    "Exception" character varying(500) NULL,
    "AdditionalData" character varying(1000) NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_LogEntries" PRIMARY KEY ("Id")
);
2025-07-30 21:51:33.486 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-29 20:21:24.361158Z'
WHERE "Id" = 1;
2025-07-30 21:51:33.491 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250729202124_AddLogEntries', '7.0.11');
2025-07-30 21:51:33.497 +03:00 [INF] Applying migration '20250730185115_AdminPanelInitialCreate'.
2025-07-30 21:51:33.575 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" RENAME COLUMN "Email" TO "Domain";
2025-07-30 21:51:33.578 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_Tenants_Email" RENAME TO "IX_Tenants_Domain";
2025-07-30 21:51:33.582 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "IsLocked" boolean NOT NULL DEFAULT FALSE;
2025-07-30 21:51:33.585 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastFailedLogin" timestamp with time zone NULL;
2025-07-30 21:51:33.590 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginIp" text NULL;
2025-07-30 21:51:33.594 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginUserAgent" text NULL;
2025-07-30 21:51:33.599 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockReason" text NULL;
2025-07-30 21:51:33.605 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockedAt" timestamp with time zone NULL;
2025-07-30 21:51:33.608 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LoginAttempts" integer NOT NULL DEFAULT 0;
2025-07-30 21:51:33.612 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "PasswordChangedAt" timestamp with time zone NULL;
2025-07-30 21:51:33.616 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "RequirePasswordChange" boolean NOT NULL DEFAULT FALSE;
2025-07-30 21:51:33.620 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "Phone" DROP NOT NULL;
2025-07-30 21:51:33.623 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "ContactPerson" DROP NOT NULL;
2025-07-30 21:51:33.627 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "AdminEmail" character varying(100) NOT NULL DEFAULT '';
2025-07-30 21:51:33.632 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Currency" text NOT NULL DEFAULT '';
2025-07-30 21:51:33.638 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "FacilityCode" character varying(6) NOT NULL DEFAULT '';
2025-07-30 21:51:33.642 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Language" text NOT NULL DEFAULT '';
2025-07-30 21:51:33.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastLogin" timestamp with time zone NULL;
2025-07-30 21:51:33.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastPayment" timestamp with time zone NULL;
2025-07-30 21:51:33.653 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Logo" text NULL;
2025-07-30 21:51:33.656 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "MonthlyFee" numeric NOT NULL DEFAULT 0.0;
2025-07-30 21:51:33.660 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "PaymentStatus" integer NOT NULL DEFAULT 0;
2025-07-30 21:51:33.665 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Subscription" integer NOT NULL DEFAULT 0;
2025-07-30 21:51:33.669 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "TotalConsumption" text NULL;
2025-07-30 21:51:33.681 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiKeys" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Key" character varying(64) NOT NULL,
    "TenantId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastUsed" timestamp with time zone NULL,
    "TotalCalls" integer NOT NULL,
    "ErrorRate" numeric NOT NULL,
    "RateLimit" integer NOT NULL,
    "RateLimitPeriod" text NOT NULL,
    "WebhookUrl" text NULL,
    "WebhookStatus" integer NULL,
    "Permissions" text NOT NULL,
    CONSTRAINT "PK_ApiKeys" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiKeys_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.696 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "SystemLogs" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TenantId" integer NULL,
    "UserId" integer NULL,
    "Level" character varying(50) NOT NULL,
    "Category" character varying(100) NOT NULL,
    "Message" character varying(200) NOT NULL,
    "Details" text NULL,
    "IpAddress" text NULL,
    "UserAgent" text NULL,
    "Timestamp" timestamp with time zone NOT NULL,
    "Exception" text NULL,
    "StackTrace" text NULL,
    CONSTRAINT "PK_SystemLogs" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SystemLogs_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_SystemLogs_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 21:51:33.710 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiUsages" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ApiKeyId" integer NOT NULL,
    "Date" timestamp with time zone NOT NULL,
    "Calls" integer NOT NULL,
    "Errors" integer NOT NULL,
    "AvgResponseTime" integer NOT NULL,
    "PeakHour" text NOT NULL,
    CONSTRAINT "PK_ApiUsages" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiUsages_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.720 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Webhooks" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Url" character varying(500) NOT NULL,
    "ApiKeyId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastDelivery" timestamp with time zone NULL,
    "SuccessRate" numeric NOT NULL,
    "RetryCount" integer NOT NULL,
    "Events" text NOT NULL,
    CONSTRAINT "PK_Webhooks" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Webhooks_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 21:51:33.725 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "AdminEmail" = 'info@demosirketi.com', "Currency" = 'TRY', "Domain" = '', "FacilityCode" = '', "Language" = 'tr', "LastLogin" = NULL, "LastPayment" = NULL, "Logo" = NULL, "MonthlyFee" = 99.99, "PaymentStatus" = 1, "Status" = 3, "Subscription" = 0, "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-30 18:51:15.436692Z', "TotalConsumption" = '0 kWh'
WHERE "Id" = 1;
2025-07-30 21:51:33.730 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "IsLocked" = FALSE, "LastFailedLogin" = NULL, "LastLoginIp" = NULL, "LastLoginUserAgent" = NULL, "LockReason" = NULL, "LockedAt" = NULL, "LoginAttempts" = 0, "PasswordChangedAt" = NULL, "RequirePasswordChange" = FALSE
WHERE "Id" = 1;
2025-07-30 21:51:33.735 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_AdminEmail" ON "Tenants" ("AdminEmail");
2025-07-30 21:51:33.740 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_FacilityCode" ON "Tenants" ("FacilityCode");
2025-07-30 21:51:33.749 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ApiKeys_Key" ON "ApiKeys" ("Key");
2025-07-30 21:51:33.754 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ApiKeys_TenantId" ON "ApiKeys" ("TenantId");
2025-07-30 21:51:33.761 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ApiUsages_ApiKeyId_Date" ON "ApiUsages" ("ApiKeyId", "Date");
2025-07-30 21:51:33.767 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_TenantId_Timestamp" ON "SystemLogs" ("TenantId", "Timestamp");
2025-07-30 21:51:33.775 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_Timestamp" ON "SystemLogs" ("Timestamp");
2025-07-30 21:51:33.780 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_UserId_Timestamp" ON "SystemLogs" ("UserId", "Timestamp");
2025-07-30 21:51:33.787 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Webhooks_ApiKeyId" ON "Webhooks" ("ApiKeyId");
2025-07-30 21:51:33.793 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250730185115_AdminPanelInitialCreate', '7.0.11');
2025-07-30 22:46:00.140 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 22:46:00.260 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 22:46:00.278 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 22:46:00.300 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 22:46:00.322 +03:00 [INF] User profile is available. Using 'C:\Users\ataka\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-30 22:46:00.401 +03:00 [WRN] Overriding address(es) 'http://localhost:5143'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-07-30 22:46:00.409 +03:00 [INF] Now listening on: http://localhost:5143
2025-07-30 22:46:00.410 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-30 22:46:00.411 +03:00 [INF] Hosting environment: Development
2025-07-30 22:46:00.412 +03:00 [INF] Content root path: C:\Users\ataka\Desktop\ElectricityTracker\TrackerAPI
2025-07-30 22:47:06.623 +03:00 [INF] Application is shutting down...
2025-07-30 23:17:07.143 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:17:07.228 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:17:07.244 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:17:07.259 +03:00 [INF] Applying migration '20250730201657_AddBillingModels'.
2025-07-30 23:17:07.340 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ElectricityMeters" ADD "ResourceTypeId" integer NULL;
2025-07-30 23:17:07.344 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ConsumptionRecords" ADD "ResourceTypeId" integer NULL;
2025-07-30 23:17:07.357 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Invoices" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceNumber" character varying(50) NOT NULL,
    "InvoiceDate" timestamp with time zone NOT NULL,
    "DueDate" timestamp with time zone NOT NULL,
    "TotalAmount" numeric(18,2) NOT NULL,
    "TaxAmount" numeric(18,2) NOT NULL,
    "NetAmount" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "TaxRate" numeric(5,2) NOT NULL,
    "Status" integer NOT NULL,
    "Type" integer NOT NULL,
    "Description" character varying(500) NULL,
    "CustomerName" character varying(100) NULL,
    "CustomerEmail" character varying(100) NULL,
    "CustomerAddress" character varying(200) NULL,
    "CustomerTaxNumber" character varying(50) NULL,
    "TenantId" integer NOT NULL,
    "CreatedById" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "PaidAt" timestamp with time zone NULL,
    CONSTRAINT "PK_Invoices" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Invoices_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_Invoices_Users_CreatedById" FOREIGN KEY ("CreatedById") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 23:17:07.364 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ResourceTypes" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Unit" character varying(20) NOT NULL,
    "Description" character varying(100) NULL,
    "Icon" character varying(50) NULL,
    "Category" integer NOT NULL,
    "DefaultPrice" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "IsActive" boolean NOT NULL,
    "TenantId" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_ResourceTypes" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ResourceTypes_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE SET NULL
);
2025-07-30 23:17:07.371 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "PaymentRecords" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceId" integer NOT NULL,
    "Amount" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "Method" integer NOT NULL,
    "Status" integer NOT NULL,
    "TransactionId" character varying(100) NULL,
    "ReferenceNumber" character varying(100) NULL,
    "Notes" character varying(500) NULL,
    "PaymentDate" timestamp with time zone NOT NULL,
    "ProcessedDate" timestamp with time zone NULL,
    "RecordedById" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_PaymentRecords" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_PaymentRecords_Invoices_InvoiceId" FOREIGN KEY ("InvoiceId") REFERENCES "Invoices" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_PaymentRecords_Users_RecordedById" FOREIGN KEY ("RecordedById") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 23:17:07.378 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "InvoiceItems" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceId" integer NOT NULL,
    "Description" character varying(100) NOT NULL,
    "Quantity" numeric(10,3) NOT NULL,
    "Unit" character varying(20) NOT NULL,
    "UnitPrice" numeric(18,2) NOT NULL,
    "TotalPrice" numeric(18,2) NOT NULL,
    "TaxRate" numeric(5,2) NOT NULL,
    "TaxAmount" numeric(18,2) NOT NULL,
    "NetAmount" numeric(18,2) NOT NULL,
    "ResourceTypeId" integer NULL,
    "ConsumptionStartDate" timestamp with time zone NULL,
    "ConsumptionEndDate" timestamp with time zone NULL,
    "Notes" character varying(500) NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_InvoiceItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_InvoiceItems_Invoices_InvoiceId" FOREIGN KEY ("InvoiceId") REFERENCES "Invoices" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_InvoiceItems_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id") ON DELETE SET NULL
);
2025-07-30 23:17:07.382 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "ElectricityMeters" SET "ResourceTypeId" = NULL
WHERE "Id" = 1;
2025-07-30 23:17:07.387 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-30 20:16:56.845081Z'
WHERE "Id" = 1;
2025-07-30 23:17:07.390 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ElectricityMeters_ResourceTypeId" ON "ElectricityMeters" ("ResourceTypeId");
2025-07-30 23:17:07.393 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_ResourceTypeId" ON "ConsumptionRecords" ("ResourceTypeId");
2025-07-30 23:17:07.396 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_InvoiceItems_InvoiceId" ON "InvoiceItems" ("InvoiceId");
2025-07-30 23:17:07.398 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_InvoiceItems_ResourceTypeId" ON "InvoiceItems" ("ResourceTypeId");
2025-07-30 23:17:07.402 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Invoices_CreatedById" ON "Invoices" ("CreatedById");
2025-07-30 23:17:07.404 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Invoices_InvoiceNumber" ON "Invoices" ("InvoiceNumber");
2025-07-30 23:17:07.407 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Invoices_TenantId_InvoiceDate" ON "Invoices" ("TenantId", "InvoiceDate");
2025-07-30 23:17:07.410 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PaymentRecords_InvoiceId_PaymentDate" ON "PaymentRecords" ("InvoiceId", "PaymentDate");
2025-07-30 23:17:07.412 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PaymentRecords_RecordedById" ON "PaymentRecords" ("RecordedById");
2025-07-30 23:17:07.416 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ResourceTypes_TenantId_Name" ON "ResourceTypes" ("TenantId", "Name");
2025-07-30 23:17:07.421 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ConsumptionRecords" ADD CONSTRAINT "FK_ConsumptionRecords_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id");
2025-07-30 23:17:07.424 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ElectricityMeters" ADD CONSTRAINT "FK_ElectricityMeters_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id");
2025-07-30 23:17:07.426 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250730201657_AddBillingModels', '7.0.11');
2025-07-30 23:31:06.726 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:31:06.783 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:31:16.296 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:31:16.389 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:31:16.407 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:31:16.424 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:42:35.204 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:42:35.404 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:42:35.420 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:42:35.435 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:42:35.451 +03:00 [INF] User profile is available. Using 'C:\Users\ataka\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-30 23:42:35.521 +03:00 [WRN] Overriding address(es) 'http://localhost:5143'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-07-30 23:42:35.527 +03:00 [INF] Now listening on: http://localhost:5143
2025-07-30 23:42:35.530 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-30 23:42:35.531 +03:00 [INF] Hosting environment: Development
2025-07-30 23:42:35.533 +03:00 [INF] Content root path: C:\Users\ataka\Desktop\ElectricityTracker\TrackerAPI
2025-07-30 23:42:51.100 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:42:51.145 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-30 23:42:51.149 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:42:51.157 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 59.8517ms
2025-07-30 23:42:51.170 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 69
2025-07-30 23:42:51.177 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:42:51.222 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:51.247 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:42:51.542 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:42:51.982 +03:00 [WRN] Failed login attempt - Email: admin@example.com
2025-07-30 23:42:52.079 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:42:52.096 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:42:52.111 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 856.7179ms
2025-07-30 23:42:52.114 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:52.120 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 950.6622ms
2025-07-30 23:42:55.781 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 71
2025-07-30 23:42:55.785 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:42:55.787 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:55.788 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:42:55.857 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:42:55.860 +03:00 [WRN] Failed login attempt - Email: testadmin@example.com
2025-07-30 23:42:55.867 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:42:55.870 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:42:55.872 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 81.4292ms
2025-07-30 23:42:55.874 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:55.877 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 95.9154ms
2025-07-30 23:42:56.618 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:42:56.621 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:42:56.622 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 4.4215ms
2025-07-30 23:42:56.626 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 71
2025-07-30 23:42:56.629 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:42:56.632 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:56.633 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:42:56.641 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:42:56.644 +03:00 [WRN] Failed login attempt - Email: testadmin@example.com
2025-07-30 23:42:56.647 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:42:56.650 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:42:56.652 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 15.5384ms
2025-07-30 23:42:56.654 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:42:56.656 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 29.3626ms
2025-07-30 23:44:19.273 +03:00 [INF] Application is shutting down...
2025-07-30 23:48:04.796 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:48:04.895 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:48:04.913 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:48:04.928 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:48:04.994 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2025-07-30 23:48:05.147 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Tenants" AS t)
2025-07-30 23:48:05.165 +03:00 [INF] User profile is available. Using 'C:\Users\ataka\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-30 23:48:05.214 +03:00 [WRN] Overriding address(es) 'http://localhost:5143'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-07-30 23:48:05.220 +03:00 [INF] Now listening on: http://localhost:5143
2025-07-30 23:48:05.223 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-30 23:48:05.225 +03:00 [INF] Hosting environment: Development
2025-07-30 23:48:05.225 +03:00 [INF] Content root path: C:\Users\ataka\Desktop\ElectricityTracker\TrackerAPI
2025-07-30 23:48:29.949 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:48:29.988 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-30 23:48:29.990 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:48:29.996 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 47.8707ms
2025-07-30 23:48:30.015 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 75
2025-07-30 23:48:30.024 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:48:30.062 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:48:30.081 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:48:30.268 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:48:30.279 +03:00 [WRN] Failed login attempt - Email: admin@demo-elektrik.com
2025-07-30 23:48:30.392 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:48:30.414 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:48:30.430 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 339.2533ms
2025-07-30 23:48:30.433 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:48:30.440 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 425.4463ms
2025-07-30 23:49:02.922 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:49:02.928 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:49:02.929 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 7.8722ms
2025-07-30 23:49:02.934 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 75
2025-07-30 23:49:02.938 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:49:02.942 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:49:02.946 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:49:03.017 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:49:03.021 +03:00 [WRN] Failed login attempt - Email: admin@demo-elektrik.com
2025-07-30 23:49:03.025 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:49:03.029 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:49:03.031 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 82.3926ms
2025-07-30 23:49:03.033 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:49:03.036 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 101.2936ms
2025-07-30 23:49:26.839 +03:00 [INF] Application is shutting down...
2025-07-30 23:49:43.221 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
REVOKE CONNECT ON DATABASE "ElectricityTrackerDB" FROM PUBLIC;
SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE datname = 'ElectricityTrackerDB';
2025-07-30 23:49:43.376 +03:00 [INF] Executed DbCommand (111ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP DATABASE "ElectricityTrackerDB";
2025-07-30 23:50:39.380 +03:00 [INF] Executed DbCommand (323ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "ElectricityTrackerDB";
2025-07-30 23:50:39.616 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2025-07-30 23:50:39.694 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:50:39.702 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:50:39.716 +03:00 [INF] Applying migration '20250729200228_InitialCreate'.
2025-07-30 23:50:39.778 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Tenants" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "CompanyName" character varying(100) NOT NULL,
    "ContactPerson" character varying(100) NOT NULL,
    "Email" character varying(100) NOT NULL,
    "Phone" character varying(20) NOT NULL,
    "Address" character varying(200) NULL,
    "TaxNumber" character varying(50) NULL,
    "TaxOffice" character varying(50) NULL,
    "Subdomain" character varying(50) NULL,
    "CustomDomain" character varying(100) NULL,
    "Status" integer NOT NULL,
    "SubscriptionStartDate" timestamp with time zone NOT NULL,
    "SubscriptionEndDate" timestamp with time zone NULL,
    "MaxUsers" integer NOT NULL,
    "MaxFacilities" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_Tenants" PRIMARY KEY ("Id")
);
2025-07-30 23:50:39.791 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Departments" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Description" character varying(500) NULL,
    "ManagerName" character varying(100) NULL,
    "ManagerEmail" character varying(100) NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    CONSTRAINT "PK_Departments" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Departments_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:39.797 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Facilities" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Address" character varying(200) NULL,
    "FacilityCode" character varying(50) NULL,
    "Type" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "DepartmentId" integer NULL,
    CONSTRAINT "PK_Facilities" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Facilities_Departments_DepartmentId" FOREIGN KEY ("DepartmentId") REFERENCES "Departments" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_Facilities_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:39.806 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Users" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "FirstName" character varying(100) NOT NULL,
    "LastName" character varying(100) NOT NULL,
    "Email" character varying(100) NOT NULL,
    "PasswordHash" character varying(255) NOT NULL,
    "Phone" character varying(20) NULL,
    "Role" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "LastLoginAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "DepartmentId" integer NULL,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Users_Departments_DepartmentId" FOREIGN KEY ("DepartmentId") REFERENCES "Departments" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_Users_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:39.813 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ElectricityMeters" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "MeterNumber" character varying(50) NOT NULL,
    "Description" character varying(100) NULL,
    "Type" integer NOT NULL,
    "CurrentReading" numeric NOT NULL,
    "PreviousReading" numeric NOT NULL,
    "LastReadingDate" timestamp with time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "FacilityId" integer NOT NULL,
    CONSTRAINT "PK_ElectricityMeters" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ElectricityMeters_Facilities_FacilityId" FOREIGN KEY ("FacilityId") REFERENCES "Facilities" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_ElectricityMeters_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:39.820 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ConsumptionRecords" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ReadingDate" timestamp with time zone NOT NULL,
    "CurrentReading" numeric NOT NULL,
    "PreviousReading" numeric NOT NULL,
    "Consumption" numeric NOT NULL,
    "UnitPrice" numeric NOT NULL,
    "TotalCost" numeric NOT NULL,
    "Source" integer NOT NULL,
    "Notes" text NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "TenantId" integer NOT NULL,
    "ElectricityMeterId" integer NOT NULL,
    CONSTRAINT "PK_ConsumptionRecords" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ConsumptionRecords_ElectricityMeters_ElectricityMeterId" FOREIGN KEY ("ElectricityMeterId") REFERENCES "ElectricityMeters" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_ConsumptionRecords_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:39.846 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Tenants" ("Id", "Address", "CompanyName", "ContactPerson", "CreatedAt", "CustomDomain", "Email", "IsActive", "MaxFacilities", "MaxUsers", "Phone", "Status", "Subdomain", "SubscriptionEndDate", "SubscriptionStartDate", "TaxNumber", "TaxOffice", "UpdatedAt")
VALUES (1, 'İstanbul, Türkiye', 'Demo Şirketi A.Ş.', 'Ahmet Yılmaz', TIMESTAMPTZ '2024-01-01 00:00:00Z', NULL, 'info@demosirketi.com', TRUE, 5, 10, '+90 212 555 0123', 0, NULL, NULL, TIMESTAMPTZ '2025-07-29 20:02:27.926878Z', '1234567890', 'Kadıköy', NULL);
2025-07-30 23:50:39.868 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Departments" ("Id", "CreatedAt", "Description", "IsActive", "ManagerEmail", "ManagerName", "Name", "TenantId", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 'Şirket genel yönetim departmanı', TRUE, 'ahmet@demosirketi.com', 'Ahmet Yılmaz', 'Genel Yönetim', 1, NULL);
2025-07-30 23:50:39.872 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Facilities" ("Id", "Address", "CreatedAt", "DepartmentId", "FacilityCode", "IsActive", "Name", "TenantId", "Type", "UpdatedAt")
VALUES (1, 'Kadıköy, İstanbul', TIMESTAMPTZ '2024-01-01 00:00:00Z', 1, 'OFIS001', TRUE, 'Ana Ofis', 1, 0, NULL);
2025-07-30 23:50:39.876 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Id", "CreatedAt", "DepartmentId", "Email", "FirstName", "IsActive", "LastLoginAt", "LastName", "PasswordHash", "Phone", "Role", "TenantId", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 1, 'admin@example.com', 'Admin', TRUE, NULL, 'User', '$2a$11$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj4J/HS.iK2O', NULL, 0, 1, NULL);
2025-07-30 23:50:39.879 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ElectricityMeters" ("Id", "CreatedAt", "CurrentReading", "Description", "FacilityId", "IsActive", "LastReadingDate", "MeterNumber", "PreviousReading", "TenantId", "Type", "UpdatedAt")
VALUES (1, TIMESTAMPTZ '2024-01-01 00:00:00Z', 1500.5, 'Ana ofis elektrik sayacı', 1, TRUE, TIMESTAMPTZ '2023-12-31 00:00:00Z', 'MTR001', 1400.0, 1, 0, NULL);
2025-07-30 23:50:39.882 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_ElectricityMeterId" ON "ConsumptionRecords" ("ElectricityMeterId");
2025-07-30 23:50:39.887 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_TenantId_ElectricityMeterId_ReadingDate" ON "ConsumptionRecords" ("TenantId", "ElectricityMeterId", "ReadingDate");
2025-07-30 23:50:39.891 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Departments_TenantId_Name" ON "Departments" ("TenantId", "Name");
2025-07-30 23:50:39.895 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ElectricityMeters_FacilityId" ON "ElectricityMeters" ("FacilityId");
2025-07-30 23:50:39.899 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ElectricityMeters_TenantId_MeterNumber" ON "ElectricityMeters" ("TenantId", "MeterNumber");
2025-07-30 23:50:39.903 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Facilities_DepartmentId" ON "Facilities" ("DepartmentId");
2025-07-30 23:50:39.911 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Facilities_TenantId_FacilityCode" ON "Facilities" ("TenantId", "FacilityCode");
2025-07-30 23:50:39.914 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_Email" ON "Tenants" ("Email");
2025-07-30 23:50:39.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_TaxNumber" ON "Tenants" ("TaxNumber");
2025-07-30 23:50:39.922 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Users_DepartmentId" ON "Users" ("DepartmentId");
2025-07-30 23:50:39.926 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Users_Email" ON "Users" ("Email");
2025-07-30 23:50:39.929 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Users_TenantId" ON "Users" ("TenantId");
2025-07-30 23:50:39.938 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT setval(
    pg_get_serial_sequence('"Tenants"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Tenants") + 1,
        nextval(pg_get_serial_sequence('"Tenants"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Departments"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Departments") + 1,
        nextval(pg_get_serial_sequence('"Departments"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Facilities"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Facilities") + 1,
        nextval(pg_get_serial_sequence('"Facilities"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Users"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Users") + 1,
        nextval(pg_get_serial_sequence('"Users"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"ElectricityMeters"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "ElectricityMeters") + 1,
        nextval(pg_get_serial_sequence('"ElectricityMeters"', 'Id'))),
    false);
2025-07-30 23:50:39.941 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250729200228_InitialCreate', '7.0.11');
2025-07-30 23:50:39.948 +03:00 [INF] Applying migration '20250729202124_AddLogEntries'.
2025-07-30 23:50:39.986 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "LogEntries" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Timestamp" timestamp with time zone NOT NULL,
    "Level" character varying(50) NOT NULL,
    "Message" character varying(255) NOT NULL,
    "Source" character varying(100) NULL,
    "UserId" character varying(100) NULL,
    "UserEmail" character varying(100) NULL,
    "TenantId" character varying(50) NULL,
    "RequestPath" character varying(255) NULL,
    "RequestMethod" character varying(20) NULL,
    "IpAddress" character varying(45) NULL,
    "Exception" character varying(500) NULL,
    "AdditionalData" character varying(1000) NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_LogEntries" PRIMARY KEY ("Id")
);
2025-07-30 23:50:39.992 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-29 20:21:24.361158Z'
WHERE "Id" = 1;
2025-07-30 23:50:39.994 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250729202124_AddLogEntries', '7.0.11');
2025-07-30 23:50:39.997 +03:00 [INF] Applying migration '20250730185115_AdminPanelInitialCreate'.
2025-07-30 23:50:40.043 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" RENAME COLUMN "Email" TO "Domain";
2025-07-30 23:50:40.046 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER INDEX "IX_Tenants_Email" RENAME TO "IX_Tenants_Domain";
2025-07-30 23:50:40.053 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "IsLocked" boolean NOT NULL DEFAULT FALSE;
2025-07-30 23:50:40.056 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastFailedLogin" timestamp with time zone NULL;
2025-07-30 23:50:40.059 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginIp" text NULL;
2025-07-30 23:50:40.062 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LastLoginUserAgent" text NULL;
2025-07-30 23:50:40.064 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockReason" text NULL;
2025-07-30 23:50:40.067 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LockedAt" timestamp with time zone NULL;
2025-07-30 23:50:40.070 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "LoginAttempts" integer NOT NULL DEFAULT 0;
2025-07-30 23:50:40.073 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "PasswordChangedAt" timestamp with time zone NULL;
2025-07-30 23:50:40.076 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "RequirePasswordChange" boolean NOT NULL DEFAULT FALSE;
2025-07-30 23:50:40.078 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "Phone" DROP NOT NULL;
2025-07-30 23:50:40.080 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ALTER COLUMN "ContactPerson" DROP NOT NULL;
2025-07-30 23:50:40.083 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "AdminEmail" character varying(100) NOT NULL DEFAULT '';
2025-07-30 23:50:40.085 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Currency" text NOT NULL DEFAULT '';
2025-07-30 23:50:40.089 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "FacilityCode" character varying(6) NOT NULL DEFAULT '';
2025-07-30 23:50:40.091 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Language" text NOT NULL DEFAULT '';
2025-07-30 23:50:40.094 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastLogin" timestamp with time zone NULL;
2025-07-30 23:50:40.097 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "LastPayment" timestamp with time zone NULL;
2025-07-30 23:50:40.099 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Logo" text NULL;
2025-07-30 23:50:40.102 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "MonthlyFee" numeric NOT NULL DEFAULT 0.0;
2025-07-30 23:50:40.105 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "PaymentStatus" integer NOT NULL DEFAULT 0;
2025-07-30 23:50:40.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "Subscription" integer NOT NULL DEFAULT 0;
2025-07-30 23:50:40.109 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Tenants" ADD "TotalConsumption" text NULL;
2025-07-30 23:50:40.115 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiKeys" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Key" character varying(64) NOT NULL,
    "TenantId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastUsed" timestamp with time zone NULL,
    "TotalCalls" integer NOT NULL,
    "ErrorRate" numeric NOT NULL,
    "RateLimit" integer NOT NULL,
    "RateLimitPeriod" text NOT NULL,
    "WebhookUrl" text NULL,
    "WebhookStatus" integer NULL,
    "Permissions" text NOT NULL,
    CONSTRAINT "PK_ApiKeys" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiKeys_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:40.122 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "SystemLogs" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TenantId" integer NULL,
    "UserId" integer NULL,
    "Level" character varying(50) NOT NULL,
    "Category" character varying(100) NOT NULL,
    "Message" character varying(200) NOT NULL,
    "Details" text NULL,
    "IpAddress" text NULL,
    "UserAgent" text NULL,
    "Timestamp" timestamp with time zone NOT NULL,
    "Exception" text NULL,
    "StackTrace" text NULL,
    CONSTRAINT "PK_SystemLogs" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SystemLogs_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_SystemLogs_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 23:50:40.130 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ApiUsages" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ApiKeyId" integer NOT NULL,
    "Date" timestamp with time zone NOT NULL,
    "Calls" integer NOT NULL,
    "Errors" integer NOT NULL,
    "AvgResponseTime" integer NOT NULL,
    "PeakHour" text NOT NULL,
    CONSTRAINT "PK_ApiUsages" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ApiUsages_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:40.137 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Webhooks" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(100) NOT NULL,
    "Url" character varying(500) NOT NULL,
    "ApiKeyId" integer NOT NULL,
    "Status" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "LastDelivery" timestamp with time zone NULL,
    "SuccessRate" numeric NOT NULL,
    "RetryCount" integer NOT NULL,
    "Events" text NOT NULL,
    CONSTRAINT "PK_Webhooks" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Webhooks_ApiKeys_ApiKeyId" FOREIGN KEY ("ApiKeyId") REFERENCES "ApiKeys" ("Id") ON DELETE RESTRICT
);
2025-07-30 23:50:40.141 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "AdminEmail" = 'info@demosirketi.com', "Currency" = 'TRY', "Domain" = '', "FacilityCode" = '', "Language" = 'tr', "LastLogin" = NULL, "LastPayment" = NULL, "Logo" = NULL, "MonthlyFee" = 99.99, "PaymentStatus" = 1, "Status" = 3, "Subscription" = 0, "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-30 18:51:15.436692Z', "TotalConsumption" = '0 kWh'
WHERE "Id" = 1;
2025-07-30 23:50:40.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Users" SET "IsLocked" = FALSE, "LastFailedLogin" = NULL, "LastLoginIp" = NULL, "LastLoginUserAgent" = NULL, "LockReason" = NULL, "LockedAt" = NULL, "LoginAttempts" = 0, "PasswordChangedAt" = NULL, "RequirePasswordChange" = FALSE
WHERE "Id" = 1;
2025-07-30 23:50:40.147 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_AdminEmail" ON "Tenants" ("AdminEmail");
2025-07-30 23:50:40.150 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Tenants_FacilityCode" ON "Tenants" ("FacilityCode");
2025-07-30 23:50:40.153 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ApiKeys_Key" ON "ApiKeys" ("Key");
2025-07-30 23:50:40.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ApiKeys_TenantId" ON "ApiKeys" ("TenantId");
2025-07-30 23:50:40.161 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ApiUsages_ApiKeyId_Date" ON "ApiUsages" ("ApiKeyId", "Date");
2025-07-30 23:50:40.165 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_TenantId_Timestamp" ON "SystemLogs" ("TenantId", "Timestamp");
2025-07-30 23:50:40.168 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_Timestamp" ON "SystemLogs" ("Timestamp");
2025-07-30 23:50:40.173 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_SystemLogs_UserId_Timestamp" ON "SystemLogs" ("UserId", "Timestamp");
2025-07-30 23:50:40.176 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Webhooks_ApiKeyId" ON "Webhooks" ("ApiKeyId");
2025-07-30 23:50:40.178 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250730185115_AdminPanelInitialCreate', '7.0.11');
2025-07-30 23:50:40.181 +03:00 [INF] Applying migration '20250730201657_AddBillingModels'.
2025-07-30 23:50:40.244 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ElectricityMeters" ADD "ResourceTypeId" integer NULL;
2025-07-30 23:50:40.248 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ConsumptionRecords" ADD "ResourceTypeId" integer NULL;
2025-07-30 23:50:40.254 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Invoices" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceNumber" character varying(50) NOT NULL,
    "InvoiceDate" timestamp with time zone NOT NULL,
    "DueDate" timestamp with time zone NOT NULL,
    "TotalAmount" numeric(18,2) NOT NULL,
    "TaxAmount" numeric(18,2) NOT NULL,
    "NetAmount" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "TaxRate" numeric(5,2) NOT NULL,
    "Status" integer NOT NULL,
    "Type" integer NOT NULL,
    "Description" character varying(500) NULL,
    "CustomerName" character varying(100) NULL,
    "CustomerEmail" character varying(100) NULL,
    "CustomerAddress" character varying(200) NULL,
    "CustomerTaxNumber" character varying(50) NULL,
    "TenantId" integer NOT NULL,
    "CreatedById" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    "PaidAt" timestamp with time zone NULL,
    CONSTRAINT "PK_Invoices" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Invoices_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_Invoices_Users_CreatedById" FOREIGN KEY ("CreatedById") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 23:50:40.262 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ResourceTypes" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Unit" character varying(20) NOT NULL,
    "Description" character varying(100) NULL,
    "Icon" character varying(50) NULL,
    "Category" integer NOT NULL,
    "DefaultPrice" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "IsActive" boolean NOT NULL,
    "TenantId" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_ResourceTypes" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ResourceTypes_Tenants_TenantId" FOREIGN KEY ("TenantId") REFERENCES "Tenants" ("Id") ON DELETE SET NULL
);
2025-07-30 23:50:40.270 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "PaymentRecords" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceId" integer NOT NULL,
    "Amount" numeric(18,2) NOT NULL,
    "Currency" character varying(3) NOT NULL,
    "Method" integer NOT NULL,
    "Status" integer NOT NULL,
    "TransactionId" character varying(100) NULL,
    "ReferenceNumber" character varying(100) NULL,
    "Notes" character varying(500) NULL,
    "PaymentDate" timestamp with time zone NOT NULL,
    "ProcessedDate" timestamp with time zone NULL,
    "RecordedById" integer NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NULL,
    CONSTRAINT "PK_PaymentRecords" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_PaymentRecords_Invoices_InvoiceId" FOREIGN KEY ("InvoiceId") REFERENCES "Invoices" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_PaymentRecords_Users_RecordedById" FOREIGN KEY ("RecordedById") REFERENCES "Users" ("Id") ON DELETE SET NULL
);
2025-07-30 23:50:40.277 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "InvoiceItems" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "InvoiceId" integer NOT NULL,
    "Description" character varying(100) NOT NULL,
    "Quantity" numeric(10,3) NOT NULL,
    "Unit" character varying(20) NOT NULL,
    "UnitPrice" numeric(18,2) NOT NULL,
    "TotalPrice" numeric(18,2) NOT NULL,
    "TaxRate" numeric(5,2) NOT NULL,
    "TaxAmount" numeric(18,2) NOT NULL,
    "NetAmount" numeric(18,2) NOT NULL,
    "ResourceTypeId" integer NULL,
    "ConsumptionStartDate" timestamp with time zone NULL,
    "ConsumptionEndDate" timestamp with time zone NULL,
    "Notes" character varying(500) NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_InvoiceItems" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_InvoiceItems_Invoices_InvoiceId" FOREIGN KEY ("InvoiceId") REFERENCES "Invoices" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_InvoiceItems_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id") ON DELETE SET NULL
);
2025-07-30 23:50:40.280 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "ElectricityMeters" SET "ResourceTypeId" = NULL
WHERE "Id" = 1;
2025-07-30 23:50:40.283 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
UPDATE "Tenants" SET "SubscriptionStartDate" = TIMESTAMPTZ '2025-07-30 20:16:56.845081Z'
WHERE "Id" = 1;
2025-07-30 23:50:40.287 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ElectricityMeters_ResourceTypeId" ON "ElectricityMeters" ("ResourceTypeId");
2025-07-30 23:50:40.290 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ConsumptionRecords_ResourceTypeId" ON "ConsumptionRecords" ("ResourceTypeId");
2025-07-30 23:50:40.293 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_InvoiceItems_InvoiceId" ON "InvoiceItems" ("InvoiceId");
2025-07-30 23:50:40.296 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_InvoiceItems_ResourceTypeId" ON "InvoiceItems" ("ResourceTypeId");
2025-07-30 23:50:40.300 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Invoices_CreatedById" ON "Invoices" ("CreatedById");
2025-07-30 23:50:40.305 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Invoices_InvoiceNumber" ON "Invoices" ("InvoiceNumber");
2025-07-30 23:50:40.308 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Invoices_TenantId_InvoiceDate" ON "Invoices" ("TenantId", "InvoiceDate");
2025-07-30 23:50:40.312 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PaymentRecords_InvoiceId_PaymentDate" ON "PaymentRecords" ("InvoiceId", "PaymentDate");
2025-07-30 23:50:40.315 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PaymentRecords_RecordedById" ON "PaymentRecords" ("RecordedById");
2025-07-30 23:50:40.318 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_ResourceTypes_TenantId_Name" ON "ResourceTypes" ("TenantId", "Name");
2025-07-30 23:50:40.323 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ConsumptionRecords" ADD CONSTRAINT "FK_ConsumptionRecords_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id");
2025-07-30 23:50:40.327 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ElectricityMeters" ADD CONSTRAINT "FK_ElectricityMeters_ResourceTypes_ResourceTypeId" FOREIGN KEY ("ResourceTypeId") REFERENCES "ResourceTypes" ("Id");
2025-07-30 23:50:40.330 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250730201657_AddBillingModels', '7.0.11');
2025-07-30 23:51:56.991 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:51:57.094 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:51:57.109 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:51:57.121 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:51:57.183 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2025-07-30 23:51:57.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Tenants" AS t)
2025-07-30 23:51:57.328 +03:00 [INF] User profile is available. Using 'C:\Users\ataka\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-30 23:51:57.378 +03:00 [WRN] Overriding address(es) 'http://localhost:5143'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-07-30 23:51:57.386 +03:00 [INF] Now listening on: http://localhost:5143
2025-07-30 23:51:57.389 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-30 23:51:57.390 +03:00 [INF] Hosting environment: Development
2025-07-30 23:51:57.391 +03:00 [INF] Content root path: C:\Users\ataka\Desktop\ElectricityTracker\TrackerAPI
2025-07-30 23:52:06.789 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:52:06.831 +03:00 [WRN] Failed to determine the https port for redirect.
2025-07-30 23:52:06.834 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:06.844 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 55.8885ms
2025-07-30 23:52:06.855 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 69
2025-07-30 23:52:06.862 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:06.900 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:06.918 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:52:07.123 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:52:07.613 +03:00 [WRN] Failed login attempt - Email: admin@example.com
2025-07-30 23:52:07.848 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:52:07.875 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:52:07.893 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 969.1136ms
2025-07-30 23:52:07.896 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:07.913 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 1057.9993ms
2025-07-30 23:52:11.235 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 67
2025-07-30 23:52:11.239 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:11.241 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:11.245 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:52:11.308 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:52:11.649 +03:00 [WRN] Failed login attempt - Email: admin@example.com
2025-07-30 23:52:11.663 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:52:11.668 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:52:11.674 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 427.1729ms
2025-07-30 23:52:11.678 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:11.685 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 450.2324ms
2025-07-30 23:52:15.295 +03:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - null null
2025-07-30 23:52:15.298 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:15.299 +03:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5143/api/auth/login - 204 null null 3.5272ms
2025-07-30 23:52:15.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 69
2025-07-30 23:52:15.308 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:15.310 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:15.311 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:52:15.315 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:52:15.468 +03:00 [WRN] Failed login attempt - Email: admin@example.com
2025-07-30 23:52:15.478 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:52:15.482 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:52:15.483 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 170.9708ms
2025-07-30 23:52:15.488 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:15.490 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 185.9829ms
2025-07-30 23:52:18.132 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5143/api/auth/login - application/json 69
2025-07-30 23:52:18.137 +03:00 [INF] CORS policy execution successful.
2025-07-30 23:52:18.138 +03:00 [INF] Executing endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:18.139 +03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ElectricityTrackerAPI.DTOs.Auth.LoginResponseDto]] Login(ElectricityTrackerAPI.DTOs.Auth.LoginDto) on controller ElectricityTrackerAPI.Controllers.Auth.AuthController (TrackerAPI).
2025-07-30 23:52:18.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loginDto_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."CreatedAt", u."DepartmentId", u."Email", u."FirstName", u."IsActive", u."IsLocked", u."LastFailedLogin", u."LastLoginAt", u."LastLoginIp", u."LastLoginUserAgent", u."LastName", u."LockReason", u."LockedAt", u."LoginAttempts", u."PasswordChangedAt", u."PasswordHash", u."Phone", u."RequirePasswordChange", u."Role", u."TenantId", u."UpdatedAt", t."Id", t."Address", t."AdminEmail", t."CompanyName", t."ContactPerson", t."CreatedAt", t."Currency", t."CustomDomain", t."Domain", t."FacilityCode", t."IsActive", t."Language", t."LastLogin", t."LastPayment", t."Logo", t."MaxFacilities", t."MaxUsers", t."MonthlyFee", t."PaymentStatus", t."Phone", t."Status", t."Subdomain", t."Subscription", t."SubscriptionEndDate", t."SubscriptionStartDate", t."TaxNumber", t."TaxOffice", t."TotalConsumption", t."UpdatedAt"
FROM "Users" AS u
INNER JOIN "Tenants" AS t ON u."TenantId" = t."Id"
WHERE u."Email" = @__loginDto_Email_0 AND u."IsActive"
LIMIT 1
2025-07-30 23:52:18.293 +03:00 [WRN] Failed login attempt - Email: admin@example.com
2025-07-30 23:52:18.319 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?', @p1='?' (DbType = DateTime), @p2='?', @p3='?', @p4='?', @p5='?', @p6='?', @p7='?', @p8='?', @p9='?', @p10='?' (DbType = DateTime), @p11='?', @p12='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "LogEntries" ("AdditionalData", "CreatedAt", "Exception", "IpAddress", "Level", "Message", "RequestMethod", "RequestPath", "Source", "TenantId", "Timestamp", "UserEmail", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12)
RETURNING "Id";
2025-07-30 23:52:18.323 +03:00 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-30 23:52:18.325 +03:00 [INF] Executed action ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI) in 184.4529ms
2025-07-30 23:52:18.327 +03:00 [INF] Executed endpoint 'ElectricityTrackerAPI.Controllers.Auth.AuthController.Login (TrackerAPI)'
2025-07-30 23:52:18.328 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5143/api/auth/login - 401 null application/json; charset=utf-8 196.3482ms
2025-07-30 23:53:56.893 +03:00 [INF] Application is shutting down...
2025-07-30 23:54:07.684 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:54:07.785 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:54:07.804 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:54:07.818 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:54:13.620 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:54:13.806 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-07-30 23:54:13.825 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-07-30 23:54:13.844 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-07-30 23:54:14.010 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
2025-07-30 23:54:14.193 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Tenants" AS t)
2025-07-30 23:54:14.223 +03:00 [INF] User profile is available. Using 'C:\Users\ataka\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-30 23:54:14.304 +03:00 [WRN] Overriding address(es) 'http://localhost:5143'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-07-30 23:54:14.311 +03:00 [INF] Now listening on: http://localhost:5143
2025-07-30 23:54:14.313 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-30 23:54:14.315 +03:00 [INF] Hosting environment: Development
2025-07-30 23:54:14.316 +03:00 [INF] Content root path: C:\Users\ataka\Desktop\ElectricityTracker\TrackerAPI
